---
# This playbook contains play to prepare the system and install StorNext FC-client on RHEL7 workstations and servers


- name: Grab the last part of the public IP of the server 
#  command: "ls /astro/local/maint/rhel7_duplexprint/pdf*"
   # improve with {{ public_netintÂ }} instead of ens8f0
  shell: "ip -f inet -o  addr show ens8f0 | gawk -F '.' '{print $4}' | gawk -F '/' '{print $1}'"
  register: ip_metadata_lastpart

- debug: var=ip_metadata_lastpart verbosity=2


#- set_fact: 
#   metadata_ip:  "{{ ip_metadata_lastpart.stdout }}"

#- debug: var=metadata_ip verbosity=2

- name: Insert the correct IP for the meta data network interface
  lineinfile: dest="/etc/sysconfig/network-scripts/ifcfg-ens8f1" line="192.168.1.{{ ip_metadata_lastpart.stdout }}"
#  lineinfile: dest=/etc/sysconfig/network-scripts/ifcfg-ens8f1 line="192.168.1.144"

#- name: Bring up meta data net interface
#  shell: "ifup ens8f1"



 